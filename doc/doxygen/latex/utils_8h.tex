\hypertarget{utils_8h}{\section{utils.\-h File Reference}
\label{utils_8h}\index{utils.\-h@{utils.\-h}}
}


This file declares various utility functions that are can be used by the storage server and client library.  


{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$pthread.\-h$>$}\\*
{\ttfamily \#include $<$sys/socket.\-h$>$}\\*
{\ttfamily \#include $<$arpa/inet.\-h$>$}\\*
{\ttfamily \#include \char`\"{}storage.\-h\char`\"{}}\\*
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structconfig__params}{config\-\_\-params}
\begin{DoxyCompactList}\small\item\em A struct to store config parameters. \end{DoxyCompactList}\item 
struct \hyperlink{structserver__record}{server\-\_\-record}
\begin{DoxyCompactList}\small\item\em Encapsulate the value associated with a key in a table. \end{DoxyCompactList}\item 
struct \hyperlink{structarguements}{arguements}
\begin{DoxyCompactList}\small\item\em Encapsulate the value associated with a key in a table. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{utils_8h_a33937a0fd045aaf83ea1cb944e38e067}{\#define {\bfseries L\-O\-G\-G\-I\-N\-G\-\_\-\-C\-L\-I\-E\-N\-T}~1}\label{utils_8h_a33937a0fd045aaf83ea1cb944e38e067}

\item 
\hypertarget{utils_8h_a25ca4579c8a1b1c57e64b2073b47c2dc}{\#define {\bfseries L\-O\-G\-G\-I\-N\-G\-\_\-\-S\-E\-R\-V\-E\-R}~1}\label{utils_8h_a25ca4579c8a1b1c57e64b2073b47c2dc}

\item 
\hypertarget{utils_8h_a1eb73c104b484cf18752169509cebfe2}{\#define \hyperlink{utils_8h_a1eb73c104b484cf18752169509cebfe2}{M\-A\-X\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N}~(1024 $\ast$ 8)}\label{utils_8h_a1eb73c104b484cf18752169509cebfe2}

\begin{DoxyCompactList}\small\item\em The max length in bytes of a command from the client to the server. \end{DoxyCompactList}\item 
\#define \hyperlink{utils_8h_af855c94dc540e943632089ce7496faac}{L\-O\-G}(x)~\{printf x; fflush(stdout);\}
\begin{DoxyCompactList}\small\item\em A macro to log some information. \end{DoxyCompactList}\item 
\#define \hyperlink{utils_8h_a32adf79142f0a426b5e782fb7cd4cad3}{D\-B\-G}(x)~\{printf x; fflush(stdout);\}
\begin{DoxyCompactList}\small\item\em A macro to output debug information. \end{DoxyCompactList}\item 
\hypertarget{utils_8h_a497f67978d53858accb67015e898458c}{\#define \hyperlink{utils_8h_a497f67978d53858accb67015e898458c}{D\-E\-F\-A\-U\-L\-T\-\_\-\-C\-R\-Y\-P\-T\-\_\-\-S\-A\-L\-T}~\char`\"{}xx\char`\"{}}\label{utils_8h_a497f67978d53858accb67015e898458c}

\begin{DoxyCompactList}\small\item\em Default two character salt used for password encryption. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{utils_8h_a73c4a410d877b6a9358c547786f2102c}{sendall} (const int sock, const char $\ast$buf, const size\-\_\-t len)
\begin{DoxyCompactList}\small\item\em Keep sending the contents of the buffer until complete. \end{DoxyCompactList}\item 
int \hyperlink{utils_8h_ab126c8228ad72abbaed5f282709446ab}{recvline} (const int sock, char $\ast$buf, const size\-\_\-t buflen)
\begin{DoxyCompactList}\small\item\em Receive an entire line from a socket. \end{DoxyCompactList}\item 
int \hyperlink{utils_8h_ae885a5871d260ab51ce6a9156f41f07e}{read\-\_\-config} (const char $\ast$config\-\_\-file, struct \hyperlink{structconfig__params}{config\-\_\-params} $\ast$params)
\begin{DoxyCompactList}\small\item\em Read and load configuration parameters. \end{DoxyCompactList}\item 
void \hyperlink{utils_8h_a97520ee582f1b7eb4c3ab665315b53c9}{logger} (F\-I\-L\-E $\ast$file, char $\ast$message, int L\-O\-G\-G\-I\-N\-G)
\begin{DoxyCompactList}\small\item\em Generates a log message. \end{DoxyCompactList}\item 
char $\ast$ \hyperlink{utils_8h_aa26d27a9072e93c052cb0c7fca7909f7}{generate\-\_\-encrypted\-\_\-password} (const char $\ast$passwd, const char $\ast$salt)
\begin{DoxyCompactList}\small\item\em Generates an encrypted password string using salt C\-R\-Y\-P\-T\-\_\-\-S\-A\-L\-T. \end{DoxyCompactList}\item 
void \hyperlink{utils_8h_a92f2177b1564f1d2dc88a185c19639da}{get\-\_\-param} (char str\mbox{[}\hyperlink{storage_8h_a00a29850f2b5b985f776f864d83e5ac3}{M\-A\-X\-\_\-\-V\-A\-L\-U\-E\-\_\-\-L\-E\-N}\mbox{]}, char to\-\_\-return\mbox{[}\hyperlink{storage_8h_a00a29850f2b5b985f776f864d83e5ac3}{M\-A\-X\-\_\-\-V\-A\-L\-U\-E\-\_\-\-L\-E\-N}\mbox{]}, int param\-\_\-num, char $\ast$delims)
\begin{DoxyCompactList}\small\item\em Split a string and return one of the split strings. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file declares various utility functions that are can be used by the storage server and client library. 

Definition in file \hyperlink{utils_8h_source}{utils.\-h}.



\subsection{Macro Definition Documentation}
\hypertarget{utils_8h_a32adf79142f0a426b5e782fb7cd4cad3}{\index{utils.\-h@{utils.\-h}!D\-B\-G@{D\-B\-G}}
\index{D\-B\-G@{D\-B\-G}!utils.h@{utils.\-h}}
\subsubsection[{D\-B\-G}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\-B\-G(
\begin{DoxyParamCaption}
\item[{}]{x}
\end{DoxyParamCaption}
)~\{printf x; fflush(stdout);\}}}\label{utils_8h_a32adf79142f0a426b5e782fb7cd4cad3}


A macro to output debug information. 

It is only enabled in debug builds. 

Definition at line 47 of file utils.\-h.

\hypertarget{utils_8h_af855c94dc540e943632089ce7496faac}{\index{utils.\-h@{utils.\-h}!L\-O\-G@{L\-O\-G}}
\index{L\-O\-G@{L\-O\-G}!utils.h@{utils.\-h}}
\subsubsection[{L\-O\-G}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-O\-G(
\begin{DoxyParamCaption}
\item[{}]{x}
\end{DoxyParamCaption}
)~\{printf x; fflush(stdout);\}}}\label{utils_8h_af855c94dc540e943632089ce7496faac}


A macro to log some information. 

Use it like this\-: L\-O\-G((\char`\"{}\-Hello \%s\char`\"{}, \char`\"{}world\textbackslash{}n\char`\"{}))

Don't forget the double parentheses, or you'll get weird errors! 

Definition at line 37 of file utils.\-h.



\subsection{Function Documentation}
\hypertarget{utils_8h_aa26d27a9072e93c052cb0c7fca7909f7}{\index{utils.\-h@{utils.\-h}!generate\-\_\-encrypted\-\_\-password@{generate\-\_\-encrypted\-\_\-password}}
\index{generate\-\_\-encrypted\-\_\-password@{generate\-\_\-encrypted\-\_\-password}!utils.h@{utils.\-h}}
\subsubsection[{generate\-\_\-encrypted\-\_\-password}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ generate\-\_\-encrypted\-\_\-password (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{passwd, }
\item[{const char $\ast$}]{salt}
\end{DoxyParamCaption}
)}}\label{utils_8h_aa26d27a9072e93c052cb0c7fca7909f7}


Generates an encrypted password string using salt C\-R\-Y\-P\-T\-\_\-\-S\-A\-L\-T. 


\begin{DoxyParams}{Parameters}
{\em passwd} & Password before encryption. \\
\hline
{\em salt} & Salt used to encrypt the password. If N\-U\-L\-L default value D\-E\-F\-A\-U\-L\-T\-\_\-\-C\-R\-Y\-P\-T\-\_\-\-S\-A\-L\-T is used. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns encrypted password. 
\end{DoxyReturn}


Definition at line 151 of file utils.\-c.



References D\-E\-F\-A\-U\-L\-T\-\_\-\-C\-R\-Y\-P\-T\-\_\-\-S\-A\-L\-T.



Referenced by storage\-\_\-auth().

\hypertarget{utils_8h_a92f2177b1564f1d2dc88a185c19639da}{\index{utils.\-h@{utils.\-h}!get\-\_\-param@{get\-\_\-param}}
\index{get\-\_\-param@{get\-\_\-param}!utils.h@{utils.\-h}}
\subsubsection[{get\-\_\-param}]{\setlength{\rightskip}{0pt plus 5cm}void get\-\_\-param (
\begin{DoxyParamCaption}
\item[{char}]{str\mbox{[}\-M\-A\-X\-\_\-\-V\-A\-L\-U\-E\-\_\-\-L\-E\-N\mbox{]}, }
\item[{char}]{to\-\_\-return\mbox{[}\-M\-A\-X\-\_\-\-V\-A\-L\-U\-E\-\_\-\-L\-E\-N\mbox{]}, }
\item[{int}]{param\-\_\-num, }
\item[{char $\ast$}]{delims}
\end{DoxyParamCaption}
)}}\label{utils_8h_a92f2177b1564f1d2dc88a185c19639da}


Split a string and return one of the split strings. 


\begin{DoxyParams}{Parameters}
{\em str} & string to be split \\
\hline
{\em to\-\_\-return} & place to return the specified paramter in str \\
\hline
{\em param\-\_\-num} & which index of the split str to return \\
\hline
{\em delims} & string of all characters used to deliminate string \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
no return value 
\end{DoxyReturn}


Definition at line 168 of file utils.\-c.



Referenced by check\-\_\-column\-\_\-types(), check\-\_\-mycolumns(), check\-\_\-mycolumns\-\_\-pred(), check\-\_\-predicates(), handle\-\_\-command(), num\-\_\-col\-\_\-val(), num\-\_\-of\-\_\-predicates(), predicate\-\_\-true(), predicates\-\_\-true(), split\-\_\-query\-\_\-get\-\_\-column(), split\-\_\-query\-\_\-get\-\_\-value(), and storage\-\_\-get().

\hypertarget{utils_8h_a97520ee582f1b7eb4c3ab665315b53c9}{\index{utils.\-h@{utils.\-h}!logger@{logger}}
\index{logger@{logger}!utils.h@{utils.\-h}}
\subsubsection[{logger}]{\setlength{\rightskip}{0pt plus 5cm}void logger (
\begin{DoxyParamCaption}
\item[{F\-I\-L\-E $\ast$}]{file, }
\item[{char $\ast$}]{message, }
\item[{int}]{L\-O\-G\-G\-I\-N\-G}
\end{DoxyParamCaption}
)}}\label{utils_8h_a97520ee582f1b7eb4c3ab665315b53c9}


Generates a log message. 


\begin{DoxyParams}{Parameters}
{\em file} & The output stream \\
\hline
{\em message} & Message to log. \\
\hline
\end{DoxyParams}


Definition at line 131 of file utils.\-c.



Referenced by main(), storage\-\_\-auth(), storage\-\_\-connect(), storage\-\_\-get(), and storage\-\_\-set().

\hypertarget{utils_8h_ae885a5871d260ab51ce6a9156f41f07e}{\index{utils.\-h@{utils.\-h}!read\-\_\-config@{read\-\_\-config}}
\index{read\-\_\-config@{read\-\_\-config}!utils.h@{utils.\-h}}
\subsubsection[{read\-\_\-config}]{\setlength{\rightskip}{0pt plus 5cm}int read\-\_\-config (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{config\-\_\-file, }
\item[{struct {\bf config\-\_\-params} $\ast$}]{params}
\end{DoxyParamCaption}
)}}\label{utils_8h_ae885a5871d260ab51ce6a9156f41f07e}


Read and load configuration parameters. 


\begin{DoxyParams}{Parameters}
{\em config\-\_\-file} & The name of the configuration file. \\
\hline
{\em params} & The structure where config parameters are loaded. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Return 0 on success, -\/1 otherwise. 
\end{DoxyReturn}


Definition at line 81 of file utils.\-c.



References M\-A\-X\-\_\-\-C\-O\-L\-U\-M\-N\-S\-\_\-\-P\-E\-R\-\_\-\-T\-A\-B\-L\-E, config\-\_\-params\-::password, config\-\_\-params\-::server\-\_\-host, config\-\_\-params\-::server\-\_\-port, and config\-\_\-params\-::username.



Referenced by main().

\hypertarget{utils_8h_ab126c8228ad72abbaed5f282709446ab}{\index{utils.\-h@{utils.\-h}!recvline@{recvline}}
\index{recvline@{recvline}!utils.h@{utils.\-h}}
\subsubsection[{recvline}]{\setlength{\rightskip}{0pt plus 5cm}int recvline (
\begin{DoxyParamCaption}
\item[{const int}]{sock, }
\item[{char $\ast$}]{buf, }
\item[{const size\-\_\-t}]{buflen}
\end{DoxyParamCaption}
)}}\label{utils_8h_ab126c8228ad72abbaed5f282709446ab}


Receive an entire line from a socket. 

\begin{DoxyReturn}{Returns}
Return 0 on success, -\/1 otherwise.
\end{DoxyReturn}
In order to avoid reading more than a line from the stream, this function only reads one byte at a time. This is very inefficient, and you are free to optimize it or implement your own function. 

Definition at line 52 of file utils.\-c.



Referenced by main(), query\-\_\-command(), storage\-\_\-auth(), storage\-\_\-get(), and storage\-\_\-set().

\hypertarget{utils_8h_a73c4a410d877b6a9358c547786f2102c}{\index{utils.\-h@{utils.\-h}!sendall@{sendall}}
\index{sendall@{sendall}!utils.h@{utils.\-h}}
\subsubsection[{sendall}]{\setlength{\rightskip}{0pt plus 5cm}int sendall (
\begin{DoxyParamCaption}
\item[{const int}]{sock, }
\item[{const char $\ast$}]{buf, }
\item[{const size\-\_\-t}]{len}
\end{DoxyParamCaption}
)}}\label{utils_8h_a73c4a410d877b6a9358c547786f2102c}


Keep sending the contents of the buffer until complete. 

\begin{DoxyReturn}{Returns}
Return 0 on success, -\/1 otherwise.
\end{DoxyReturn}
The parameters mimic the send() function. 

Definition at line 32 of file utils.\-c.



Referenced by handle\-\_\-command(), query\-\_\-command(), storage\-\_\-auth(), storage\-\_\-get(), and storage\-\_\-set().

